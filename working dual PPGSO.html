<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <!-- Using GlowScript locally, based on the work of Vesa Lappalainen vesal@jyu.fi -->
        <title>VP with PyInstall</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" type="text/css" href="jg/jg-style.css" />
        <link type="text/css" href="glowscript_libraries/jquery-ui.custom.css" rel="stylesheet" />
        <link type="text/css" href="glowscript_libraries/ide.css" rel="stylesheet" />
    </head>
    <body>
    <div>
        <pre>This experiment
            includes glowscript-compatible purePython files via getSource and then runCode()
            and it pyInstalls RS-compatible purePython files test2.py via pyInstall
          but those are two parallel universes.
            The pyInstall/Rapydscript universe honors imports
            The getSource/Glowscript universe does not.
        </pre>
        <script type="text/javascript" src="glowscript_libraries/Roboto_Medium_ttf_sans.js"></script>
        <script type="text/javascript" src="glowscript_libraries/NimbusRomNo9L_Med_otf_serif.js"></script>
        <script type="text/javascript" src="glowscript_libraries/jquery.min.js"></script>
        <script type="text/javascript" src="glowscript_libraries/jquery-ui.custom.min.js"></script>
        <script type="text/javascript" src="glowscript_libraries/editor.js"></script>
        <script type="text/javascript" src="glowscript_libraries/RSrun.2.7.min.js"></script>
        <script type="text/javascript" src="glowscript_libraries/glow.2.7.min.js"></script>
        <script type="text/javascript" src="glowscript_libraries/split.min.js"></script>

        <button onclick="runCode()">Run</button>
        <button onclick="saveCode()">Save</button>
        <a href="VPythonDocs/index.html" target="_blank">Help</a>
        <button id="export" onclick="exportCode()">Export</button>
        <form>
            <input type="file" id="read_local_file" />
            </form>
        <script type="text/javascript" src="jg/first.js"></script>
        <div id="gserrors" style="font-family:Verdana;font-size:13px;color:#c00"></div>
        <div class="api">
        <div id="sourcetext" class="split split-horizontal"></div>
        <div id="glows" class="split split-horizontal"></div>
        <div id="printing" class="split split-horizontal"></div>
        </div>
    </div>

///////////
/////////////   pyInstall
//////////
    <script type="text/javascript" src="rapydscript.js"></script>
  <script>   var compiler = RapydScript.create_embedded_compiler();

////////////////////////create utilities in python///////////////////////
eval(compiler.compile(`
def saveLib(name,content): #save content in the virtual filesystem
    path = '__stdlib__/' + name
    RapydScript.file_data[path] = content

def readLib(name): #retrieve and return content
    path = '__stdlib__/' + name
    return RapydScript.file_data[path]

def showLib():
    for filename in  dir(RapydScript.file_data)[-6:]:
      print(filename)
`, options = { 'basedir':'__stdlib__','omit_baselib':true} )) ///////////////////////
/////////////////////////////////////////////////////////////////////////////////////

async function compileThis(name,content){
///////////////////////////use saveLib to compile and save//////////////
  eval(compiler.compile(`saveLib(name,content)`
    ,options = {'basedir':'__stdlib__', 'omit_baselib':true} ))
}

async function pyInstall(fileName){
//////////retrieve py files from filesystem, install as pyj///////////
    const response = await fetch(fileName);
    const content = await response.text()
    console.log('pyInstalling ' + fileName ) //+ ':\n content:\n ' + content)
    await compileThis(fileName + 'j', content);
}


         Promise.all([   pyInstall('test2.py')
                    ]).then(doMain)

function doMain(){
//////////////////
window.eval(compiler.compile(`
from test2 import comment
`,options = {'basedir':'__stdlib__','omit_baselib':true} )) ////////////////////////
}
//doMain //pyInstall universe


///////////
/////////////   getSource
//////////
async function getSource(fileName){
//////////retrieve a p files from filesystem, install as pyj///////////
    console.log('fetching: ' + fileName + ' ??')
    const response = await fetch(fileName);
    const content = await response.text()
    return content
}

async function notYet(){
  /////// because glowscript will not import other files
  //////  we just amalgamate a bunch py files.  they work as if one big py file.  They can't import other files.
  source=''
  source += await getSource('PPGSOincrementalLayout_Main.py') //this goes to RapydScript
  source += await getSource('PPGSOincrementalLayout.py') //this goes to RapydScript
  runCode() //this goes into glowscript preprocessor, etc.
}
notYet()
        </script>



<!-- this includes but does not import one pure python file (test.py) -->
<script type="text/javascript" src="jg/third.js"></script>
<script type="text/javascript">


</script>
</html>
